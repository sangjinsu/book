# Clean Code

2020.07.31 발행, 지은이 **로버트 C. 마틴**, 올긴이 **박재호, 이해영 **, 출판사 인사이트

## 부록A. 동시성 II 

#### [데드락](https://ko.wikipedia.org/wiki/%EA%B5%90%EC%B0%A9_%EC%83%81%ED%83%9C)

조건 4가지를 충족하면 데드락이 발생한다.

- 상호 배제 Mutual Exclusion
- 잠금과 대기 Lock & Wait
- 선점 불가 No Preemption
- 순환 대기 Circular Wait

##### [상호 배제](https://ko.wikipedia.org/wiki/%EC%83%81%ED%98%B8_%EB%B0%B0%EC%A0%9C)

여러 스레드가 한 자원을 공유하지만 자원이 동시에 사용하지 못하는 경우 혹은 개수가 제한적인 상황이다. 

##### 잠금과 대기

한 스레드가 필요 자원을 모두 점유하여 다른 스레드들이 대기하는 상황이다.

##### [선점 불가](https://ko.wikipedia.org/wiki/%EB%B9%84%EC%84%A0%EC%A0%90_%EC%8A%A4%EC%BC%80%EC%A4%84%EB%A7%81)

한 스레드가 점유한 자원을 다른 스레드가 뺐지 못하는 상황이다.

##### 순환 대기

각 프로세스는 순환적으로 다음 프로세스가 요구하는 자원을 가지고 있다.

---

#### 데드락 관리

- 상호 배제 조건 제거
  - 동시 사용이 가능한 자원을 활용한다
  - 자원 수를 스레드 수 이상으로 늘린다
  - 자원 점유 전에 필요 자원을 점유할 수 있는지 확인한다
- 잠금과 대기 조건 제거
  - 한 스레드에 수행에 필요한 모든 자원을 할당하고 모든 자원 중 한 자원이라도 점유하지 못하면 가진 자원을 포기하도록 한다. 하지만 기아 상태, 라이브락 문제점이 존재한다.
    - [기아 상태](https://ko.wikipedia.org/wiki/%EA%B8%B0%EC%95%84_%EC%83%81%ED%83%9C) 한 스레드가 계속해서 필요한 자원을 점유하지 못하는 상태
    - [라이브락](https://zepeh.tistory.com/196) 한 프로세스가 이미 자우너을 점유한 상태에서 다른 프로세스가 그 자원을 사용하기 위해 무한하게 대기하는 상태
- 선점 불가 조건 제거
  - 자원을 점유한 스레드에게 점유 상태를 해제해달라고 요청한다. 스레드가 자원을 기다려도 되지만 구현이 쉽지 않다.
- 순환 대기 조건 제거
  - 스레드가 자원을 점유할 때 자원에 순서를 두고 점유한다. 하지만 자원 할당 순서와 자원 사용 순서가 다를 수 있고 순서대로 자원을 할당하기 힘든 상황도 있다.

