# Inside Javascript

##  Chapter05 실행 컨텍스트와 클로저

### 실행 컨텍스트 개념

- 실행 context  

  > 실행 가능한 코드를 형상화하고 구분하는 추상적인 개념
  >
  > 실행 가능한 자바스크립트 코드 블록이 실행되는 환경

- 실행 context 생성

  > 현재 실행되는 컨텍스트에서 이 컨텍스트와 고나련 없는 실행 코드가 실행되면, 새로운 컨텍스트가 생성되어 호출 스택에 들어가고 제어권이 그 켄텍스트로 이동한다

---

#### 실행 컨텍스트 생성 과정

- 활성 객체와 변수 객체

- 스코프 체인

  ```js
  function execute(param1, param2){
      const a = 1
      const b = 2
      function func(){
          return a+b
      }
      return param1 + param2 + func()
  }
  
  execute(3,)
  ```

  ##### 활성 객체 생성

  - 활성 객체란 실행 컨텍스트가 생성되면서 자바스크립트 엔진이 해당 컨텍스트에서 실행에 필요한 여러 정보를 가진 객체를 생성한 것이다
  - 활성 객체는 매개변수나 사용자 정의 변수, 객체를 저장하고 새로운 컨텍스트로 접근 가능하게 되어 있다
  - 엔진 내부에서 접근할 수 있고 사용자는 접근할 수 없다

  ##### arguments 객체 생성

  - 활성 객체는 `arguments` 프로퍼티로 이 arguments 객체를 참조한다

  ##### 스코프 정보 생성

  - 현재 컨텍스트의 유효 범위를 나타내는 스코프 정보를 생성한다
  - **스코프 정보는 현재 실행 중인 실행 컨텍스트 안에서 연결 리스트와 유사한 형식으로 만들어진다**
  - 스코프 정보는 현재 컨텍스트의 변수 뿐 아니라 상위 실행 컨텍스트의 변수도 접근이 가능하다
  - 스코프 정보에서 찾지 못한 변수는 정의하지 않은 변수에 접근하는 것으로 판단하고 에러를 발생시킨다
  - 이 연결 리스트를 스코프 체인이라고 하는데 [[scope]] 프로퍼티로 참조된다

  ##### 변수 생성

  - 활성 객체, 변수 객체는 같은 말이다
  - 변수 객체 안에서 호출된 함수 인자는 각각의 프로퍼티가 만들어지고 값이 할당된다
  - 값이 넘겨지지 않았다면 `undefined` 가 할당된다
  - `execute()` 함수 안에 정의된 변수 a,b 와 함수 func 가 생성된다
  - <u>**이 과정에서 변수나 내부 함수를 단지 메모리에 생성하고 초기화는 각 변수나 함수에 해당하는 표현식이 실행되기 전가지는 이루어지지 않고 `undefined` 가 할당된다. 표현식 실행은 변수 객체 생성이 다 이루어진 후에 시작한다**</u>

  ##### this 바인딩

  - `this` 키워드를 사용하는 값이 할당된다
  - `this` 가 참조하는 객체가 없으면 전역 객체를 참조한다 

---

#### 코드 실행

- `undefined`가 할당된 변수 a, b 에도 실행 과정에서 값이 할당된다

- 전역 실행 컨텍스트는 일반 실행 컨텍스트와 다르게 arguments 객체가 없고 전역 객체 하나만을 포함하는 스코프 체인이 있다

- 전역 실행 컨텍스트는 변수를 초기화하고 이것의 내부 함수는 일반적인 탑 레벨 함수로 선언된다 

- 전역 실행 켄텍스트의 변수 객체가 전역 객체로 사용되며 전역 실행 컨텍스트에서 변수 객체가 전역 객체이다 

- Node.js 에서는 다르게 동작한다

  ```js
  var a = 10
  b = 5
  
  // browser
  window.a // 10
  window.b // 5
  
  // node.js
  global.a // undefined
  global.b // 5
  ```

  - Node.js 는 최상위 코드가 브라우저와 달리 전역 코드가 아니다
  - `var` 를 사용하지 않는 경우 전역 객체인 `global` 에 할당되므로 주의해야 한다 